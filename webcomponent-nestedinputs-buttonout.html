<html>

<head>
    <title>Autofill without web components</title>
</head>
<script>
    customElements.define("autofill-form", class AutoFillForm extends HTMLElement {

        constructor() {
            // Always call super first in constructor
            super();

            let template = document.getElementById("autofill-form-template");
            let templateContent = template.content;

            const shadowRoot = this.attachShadow({ mode: "open" });

            shadowRoot.appendChild(templateContent.cloneNode(true));
        }

    });
    const init = () => {
        document.getElementById('autofill-form').addEventListener('submit',
            (e) => {
                e.preventDefault();

                // This would be a cleaner way to do it
                // const data = new FormData(e.target);
                // data is an empty object!
                // const value = Object.fromEntries(data.entries());
                
                const value = {};
                document.querySelector('autofill-form').shadowRoot.querySelectorAll('input').forEach(element => {
                  value[element.name] = element.value;  
                });
                console.log(value);
                localStorage.setItem('data', JSON.stringify(value))
            }
        )
    }


</script>

<body onload="init()">

    <template id="autofill-form-template">
        <style>
            label,
            button {
                display: block;
                margin-top: 1rem;
            }
        </style>
        <label for="firstName">First Name:</label>
        <input name="firstName" type="text" autocomplete="given-name">

        <label for="lastName">Last Name:</label>
        <input name="lastName" type="text" autocomplete="family-name">

        <label for="username">Username:</label>
        <input name="username" type="username" autocomplete="username">

        <label for="password">Password:</label>
        <input name="password" type="password" autocomplete="password">

    </template>

    <form id="autofill-form">
        <autofill-form></autofill-form>
        <input type="submit" value="Save Details" id="save-details"/>

    </form>
</body>

<p>
    Notes:
<ul>
    <li>If the button is outside of the template, autofill for username and password works! But if you put the button
        inside the template, it doesn't.</li>
    <li>If you attempt to create `new FormData(e.target)` on submit of the form with the button outside the template,
        you get empty data - this is probably WAI?</li>
    <li>If you move the button inside the template and click it, the submit event listener for the form never fires at all.</li>
</ul>

</p>

</html>